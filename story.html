<!DOCTYPE html>
<html lang="sq">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lexo Histori â€¢ StoryVerse</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body class="bg-light text-dark" onload="loadStoryPage()">

<!-- Navbar -->
<nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm px-3">
    <a class="navbar-brand" href="index.html">ğŸ“– StoryVerse</a>
    <div class="ms-auto d-flex align-items-center">
        <button id="modeBtn" class="btn btn-outline-secondary me-2" onclick="toggleMode()">ğŸŒ</button>
    </div>
</nav>

<!-- Main content -->
<div class="container my-4">
    <div class="card p-4 shadow-sm">
        <!-- Story Title -->
        <h2 id="storyTitle" class="card-title mb-3"></h2>

        <!-- Author & Follow -->
        <div class="d-flex align-items-center mb-3">
            <img id="authorAvatar" class="rounded-circle me-2" width="50" height="50" alt="Avatar">
            <a id="authorName" href="#" class="fw-bold text-decoration-none me-2"></a>
            <button id="followBtn" class="btn btn-outline-primary btn-sm" onclick="toggleFollow()">Ndjek</button>
        </div>

        <!-- Story Content -->
        <p id="storyContent" class="card-text mb-3"></p>

        <!-- Action Buttons -->
        <div class="d-flex gap-2 mb-3 flex-wrap">
            <button id="likeBtn" class="btn btn-danger btn-sm" onclick="likeStory()">
                â¤ï¸ Like (<span id="likeCount"></span>)
            </button>
            <button class="btn btn-primary btn-sm" onclick="shareStory()">ğŸ“¤ Share</button>
            <button class="btn btn-warning btn-sm" onclick="bookmarkStory()">ğŸ”– Favorit</button>
        </div>

        <!-- Comments Section -->
        <div class="mt-4">
            <h5>ğŸ’¬ Komentet</h5>
            <div id="commentsList" class="mb-3"></div>
            <textarea id="commentInput" class="form-control mb-2" placeholder="Shkruaj njÃ« koment..."></textarea>
            <button class="btn btn-success btn-sm" onclick="addComment()">Shto Koment</button>
        </div>
    </div>
</div>

<!-- Scripts -->
<script src="story.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
/* Dark / Light Mode Toggle */
function toggleMode() {
    document.body.classList.toggle("bg-dark");
    document.body.classList.toggle("text-light");
    document.body.classList.toggle("bg-light");
    document.body.classList.toggle("text-dark");

    const btn = document.getElementById("modeBtn");
    btn.textContent = document.body.classList.contains("bg-dark") ? "ğŸŒ™" : "ğŸŒ";
}

/* Follow Button Logic */
function toggleFollow() {
    const users = JSON.parse(localStorage.getItem("users")) || [];
    const author = users.find(u => u.username === storyData.author);
    const me = users.find(u => u.username === currentUser);
    if (!author || !me) return;

    me.following = me.following || [];
    author.followers = author.followers || [];

    const btn = document.getElementById("followBtn");

    if (me.following.includes(author.username)) {
        // Unfollow
        me.following = me.following.filter(u => u !== author.username);
        author.followers = author.followers.filter(u => u !== currentUser);
        btn.textContent = "Ndjek";
        btn.classList.remove("btn-success");
        btn.classList.add("btn-outline-primary");
        if(typeof showNotification==='function') showNotification(`TashmÃ« nuk e ndjek ${author.username}`);
    } else {
        // Follow
        me.following.push(author.username);
        author.followers.push(currentUser);
        btn.textContent = "âœ… Ndiqur";
        btn.classList.remove("btn-outline-primary");
        btn.classList.add("btn-success");
        if(typeof showNotification==='function') showNotification(`Tani e ndjek ${author.username}`);
    }

    localStorage.setItem("users", JSON.stringify(users));
}

function updateFollowButton() {
    const btn = document.getElementById("followBtn");
    if (!btn || !storyData || !currentUser) return;

    if (storyData.author === currentUser) {
        btn.style.display = "none";
        return;
    }

    const users = JSON.parse(localStorage.getItem("users")) || [];
    const author = users.find(u => u.username === storyData.author);
    if (!author) return;

    if ((author.followers || []).includes(currentUser)) {
        btn.textContent = "âœ… Ndiqur";
        btn.classList.remove("btn-outline-primary");
        btn.classList.add("btn-success");
    } else {
        btn.textContent = "Ndjek";
        btn.classList.remove("btn-success");
        btn.classList.add("btn-outline-primary");
    }
}
</script>
</body>
</html>
